<button id="getLocationBtn">取得我的位置</button>
<p id="output"></p>

<script>
// DOM 元素
const btn = document.getElementById("getLocationBtn");
const output = document.getElementById("output");

// 點擊事件
btn.addEventListener("click", () => {
  output.textContent = "定位中，請稍候...";
  getLocation();
});

// 主流程：嘗試瀏覽器定位 → 若失敗改用 IP 定位
function getLocation() {
  if ("geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const { latitude, longitude, accuracy } = pos.coords;
        output.innerHTML = `
          <strong>GPS 定位成功（高精準）</strong><br>
          緯度：${latitude}<br>
          經度：${longitude}<br>
          精度：±${accuracy} 公尺
        `;
      },
      (err) => {
        console.warn("GPS 失敗，改用 IP：", err);
        fetchByIP(); // GPS 失敗 → 改 IP
      },
      { enableHighAccuracy: true, timeout: 6000 }
    );
  } else {
    fetchByIP(); // 不支援 GPS → 改 IP
  }
}

// 使用 IP 基礎定位（HTTP 也能用）
async function fetchByIP() {
  try {
    output.textContent = "GPS 定位不可用，正在以 IP 方式定位...";
    const res = await fetch("https://ipapi.co/json/");
    const data = await res.json();

    output.innerHTML = `
      <strong>IP 定位成功（較低精準）</strong><br>
      國家：${data.country_name}<br>
      城市：${data.city}<br>
      緯度：${data.latitude}<br>
      經度：${data.longitude}<br>
      （可能誤差數公里）
    `;
  } catch (error) {
    output.innerHTML = "<strong>定位失敗：無法取得 IP 資訊</strong>";
  }
}
</script>
