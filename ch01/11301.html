<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>通用定位 + 感測器權限</title>
</head>
<body>
  <h2>共用版（iPhone + Android）</h2>
  <button id="actionBtn">啟動定位與感測器</button>

  <script>
    // ===== iPhone 必須：感測器授權 =====
    async function requestIOSPermission() {
      try {
        // iOS DeviceMotion
        if (typeof DeviceMotionEvent !== "undefined" && DeviceMotionEvent.requestPermission) {
          const r1 = await DeviceMotionEvent.requestPermission();
          console.log("DeviceMotionEvent:", r1);
        }

        // iOS DeviceOrientation
        if (typeof DeviceOrientationEvent !== "undefined" && DeviceOrientationEvent.requestPermission) {
          const r2 = await DeviceOrientationEvent.requestPermission();
          console.log("DeviceOrientationEvent:", r2);
        }
      } catch (e) {
        console.log("iOS 感測器授權錯誤:", e);
      }
    }

    // ===== Android / 桌機：Permission API（可有可無）=====
    async function requestSensorPermissions() {
      if (!navigator.permissions) return;

      try {
        await navigator.permissions.query({ name: "accelerometer" });
        await navigator.permissions.query({ name: "gyroscope" });
        console.log("Android / Chrome 感測器權限查詢完成");
      } catch (e) {
        console.log("Android 感測器權限查詢錯誤:", e);
      }
    }

    // ===== 地理位置 =====
    function getCurrentLocation() {
      if (!("geolocation" in navigator)) {
        console.log("此瀏覽器不支援定位");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const c = pos.coords;
          console.log("---- 位置資訊 ----");
          console.log("緯度:", c.latitude);
          console.log("經度:", c.longitude);
          console.log("精度:", c.accuracy);
          console.log("海拔:", c.altitude);
          console.log("方向:", c.heading);
          console.log("速度:", c.speed);
          console.log("------------------");
        },
        (err) => console.log("定位失敗:", err)
      );
    }

    // ===== 主按鈕 =====
    document.getElementById("actionBtn").addEventListener("click", async () => {
      await requestIOSPermission();      // iPhone 必須
      await requestSensorPermissions();  // Android 有用
      getCurrentLocation();              // GPS 定位
    });
  </script>
</body>
</html>
